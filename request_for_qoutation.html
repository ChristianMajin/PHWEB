<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PhilHealth Procurement System</title>

<!-- ===================== STYLES ===================== -->
<style>
* { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
body { margin: 0; background:#fff; color:#000; }

/* ===== HEADER ===== */
.header {
  display:flex;
  align-items:center;
  background:#8fe04e;
  padding:10px 20px;
}

.logo {
  display:flex;
  align-items:center;
  background:#fff;
  padding:5px 15px;
  border-radius:40px;
  margin-right:40px;
}
.logo img { height:45px; margin-right:10px; }
.logo span { font-weight:bold; font-size:14px; }

/* ===== NAV BAR ===== */
.nav { display:flex; gap:30px; font-weight:bold; font-size:14px; }
.nav a {
  text-decoration:none;
  color:#000;
  position:relative;
  padding:5px 0;
  transition:color .2s, transform .2s;
}
.nav a::after {
  content:'';
  position:absolute;
  left:0; bottom:-3px;
  width:0; height:3px;
  background:#000;
  transition:width .3s;
}
.nav a:hover { color:#3c6; transform:scale(1.05); }
.nav a:hover::after,
.nav a.active::after { width:100%; }

/* ===== CONTENT ===== */
.container { padding:20px; }

/* ===== TABLE ===== */
table { width:100%; border-collapse:collapse; table-layout:fixed; font-size:13px; }
thead th {
  border:1px solid #bfbfbf;
  background:#f2f2f2;
  padding:6px;
  cursor:pointer;
}
thead th:hover { background:#e5f7d4; }

tbody td {
  border:1px solid #d9d9d9;
  padding:4px 6px;
  height:28px;
}
tbody tr:hover { background:#eaf4ff; }

td input, td select {
  width:100%;
  border:none;
  padding:4px 6px;
  font-size:12.5px;
  outline:none;
}
td input:focus, td select:focus {
  border:1px solid #5aa300;
  background:#f2fff0;
}

/* ===== BUTTONS ===== */
.export-buttons { margin-top:15px; }
.export-buttons button {
  padding:6px 12px;
  margin-right:6px;
  cursor:pointer;
  border:none;
  border-radius:4px;
  font-size:13px;
}
.btn-success { background:#5aa300; color:#fff; }
.btn-danger { background:#d9534f; color:#fff; }
.btn-info { background:#5bc0de; color:#fff; }

/* ===== MODAL ===== */
.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  z-index:9999;
}
.modal-content {
  background:#fff;
  width:420px;
  margin:12% auto;
  padding:20px;
  border-radius:6px;
}
.modal-buttons { text-align:right; margin-top:15px; }
.modal-buttons button { padding:6px 12px; cursor:pointer; }
.btn-cancel { background:#ccc; }
.btn-confirm { background:#5aa300; color:#fff; }
</style>

<!-- ===================== LIBRARIES ===================== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>

<!-- ===================== HEADER ===================== -->
<div class="header">
  <div class="logo">
    <img src="https://www.parfait.com.ph/images/product-icon/philhealth-icon.png">
    <span>PhilHealth<br><small>Your Partner in Health</small></span>
  </div>

  <nav class="nav">
    <a href="purchase_request.html" class="active">PURCHASE REQUEST</a>
    <a href="request_for_qoutation.html">REQUEST FOR QUOTATION</a>
    <a href="philgeps_posting.html">PHILGEPS POSTING OF RFQ</a>
    <a href="notice_of_award.html">NOTICE OF AWARD</a>
    <a href="contract.html">CONTRACT</a>
    <a href="supplier_directory.html">SUPPLIER DIRECTORY</a>
  </nav>
</div>

<!-- ===================== CONTENT ===================== -->
<div class="container">
<table>
<thead>
<tr>
  <th data-col="0">Control #</th>
  <th data-col="1">Ref PR #</th>
  <th data-col="2">Date Prepared</th>
  <th data-col="3">Date Opening</th>
  <th data-col="4">Date Closing</th>
</tr>
</thead>

<tbody>
<tr class="main-row">
  <td><input></td>
  <td><input type="number"></td>
  <td><input type="date"></td>
  <td><input type="date"></td>
  <td><input type="date"></td>
</tr>
</tbody>
</table>

<div class="export-buttons">
  <button class="btn-success" onclick="exportExcel()">Save Excel</button>
  <button class="btn-danger" onclick="openPDF()">Save PDF</button>
  <button class="btn-info" onclick="exportCSV()">Save CSV</button>
  <button id="addRowBtn">+</button>
</div>
</div>

<!-- ===================== PDF MODAL ===================== -->
<div id="paperModal" class="modal">
  <div class="modal-content">
    <b>Select Paper Size</b><br><br>
    <label><input type="radio" name="paper" value="a4" checked> A4</label><br>
    <label><input type="radio" name="paper" value="letter"> Letter</label><br><br>
    <div class="modal-buttons">
      <button class="btn-cancel" onclick="closePDF()">Cancel</button>
      <button class="btn-confirm" onclick="exportPDF()">Export</button>
    </div>
  </div>
</div>

<!-- ===================== SCRIPTS ===================== -->
<script>
/* ===== LOCALSTORAGE FUNCTIONS ===== */
function saveToLocalStorage() {
  const tbody = document.querySelector("tbody");
  const data = [...tbody.rows].map(r => ({
    inputs: [...r.querySelectorAll("input")].map(i => i.value)
  }));
  localStorage.setItem("request_for_quotation_data", JSON.stringify(data));
}

function loadFromLocalStorage() {
  const saved = localStorage.getItem("request_for_quotation_data");
  if (saved) {
    try {
      const tbody = document.querySelector("tbody");
      const data = JSON.parse(saved);
      if (data.length > 0) {
        tbody.innerHTML = "";
        data.forEach(rowData => {
          const row = tbody.querySelector(".main-row")?.cloneNode(true) || document.createElement("tr");
          row.classList.add("main-row");
          row.querySelectorAll("input").forEach((i, idx) => i.value = rowData.inputs[idx] || "");
          tbody.appendChild(row);
        });
      }
    } catch (e) {
      console.error("Error loading saved data:", e);
    }
  }
}

function attachInputListeners() {
  document.querySelectorAll("input").forEach(el => {
    el.addEventListener("change", saveToLocalStorage);
    el.addEventListener("blur", saveToLocalStorage);
  });
}

/* ===== LOAD DATA ON PAGE LOAD ===== */
window.addEventListener("DOMContentLoaded", () => {
  loadFromLocalStorage();
  attachInputListeners();
});

/* ===== ADD ROW ===== */
function addNewRow() {
  const tbody = document.querySelector("tbody");
  const row = tbody.querySelector(".main-row").cloneNode(true);
  row.querySelectorAll("input").forEach(i=>i.value="");
  tbody.appendChild(row);
  row.querySelector("input").focus();
  attachInputListeners();
  saveToLocalStorage();
}
document.getElementById("addRowBtn").onclick = addNewRow;

/* ===== CTRL + F HOTKEY (WORKING) ===== */
document.addEventListener("keydown", e => {
  if (e.ctrlKey && e.key.toLowerCase() === "f") {
    e.preventDefault();
    addNewRow();
  }
}, true);

/* ===== SORTING ===== */
document.querySelectorAll("thead th").forEach(th=>{
  let asc=true;
  th.onclick=()=>{
    const idx=th.dataset.col;
    const tbody=document.querySelector("tbody");
    [...tbody.rows].sort((a,b)=>{
      return asc
        ? a.cells[idx].innerText.localeCompare(b.cells[idx].innerText)
        : b.cells[idx].innerText.localeCompare(a.cells[idx].innerText);
    }).forEach(r=>tbody.appendChild(r));
    asc=!asc;
  };
});

/* ===== EXPORT ===== */
function exportExcel(){
  const ws=XLSX.utils.table_to_sheet(document.querySelector("table"));
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Sheet1");
  XLSX.writeFile(wb,"purchase_request.xlsx");
}
function exportCSV(){ exportExcel(); }
function openPDF(){ paperModal.style.display="block"; }
function closePDF(){ paperModal.style.display="none"; }
function exportPDF(){
  closePDF();
  html2pdf().from(document.querySelector("table")).save("purchase_request.pdf");
}
</script>

</body>
</html>
