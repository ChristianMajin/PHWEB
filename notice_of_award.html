<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PhilHealth Procurement System</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: Arial, Helvetica, sans-serif;
    }

    body {
      margin: 0;
      background-color: #ffffff;
      color: #000;
    }
    .status-select {
  width: 100%;
  height: 26px;
  font-size: 12.5px;
  padding: 2px 6px;
  border: 1px solid #bfbfbf;
  border-radius: 3px;
  background-color: #ffffff;
  cursor: pointer;
}

.status-select:focus {
  outline: none;
  border-color: #5aa300;
  box-shadow: 0 0 2px rgba(90, 163, 0, 0.6);
}


    .header {
      display: flex;
      align-items: center;
      background-color: #8fe04e;
      padding: 10px 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      margin-right: 30px;
      background: #fff;
      padding: 5px 15px;
      border-radius: 40px;
    }

    .logo img {
      height: 45px;
      margin-right: 10px;
    }

    .logo span {
      font-weight: bold;
      font-size: 14px;
    }

    .nav {
      display: flex;
      gap: 30px;
      font-weight: bold;
      font-size: 14px;
    }

    .nav a {
      text-decoration: none;
      color: #000;
      padding-bottom: 3px;
    }

    .nav a.active {
      border-bottom: 3px solid #000;
    }

    .container {
      padding: 20px;
    }
    .processor-select {
  width: 100%;
  height: 26px;
  font-size: 12.5px;
  padding: 2px 6px;
  border: 1px solid #bfbfbf;
  border-radius: 3px;
  background-color: #ffffff;
  cursor: pointer;
}

.processor-select:focus {
  outline: none;
  border-color: #5aa300;
  box-shadow: 0 0 2px rgba(90, 163, 0, 0.6);
}


    table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed; 
  font-size: 13px;
}

thead th {
  border: 1px solid #bfbfbf;
  background-color: #f2f2f2;
  padding: 6px;
  text-align: center;
  font-weight: bold;
}
footer {
  margin-bottom: 0%;
}

tbody td {
  border: 1px solid #d9d9d9;
  padding: 4px 6px;
  height: 28px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}


tbody tr:hover {
  background-color: #eaf4ff;
}

    .footer {
      background-color: #8fe04e;
      text-align: center;
      padding: 10px;
      font-weight: bold;
      margin-top: 40px;
    }

    thead th {
  border-bottom: 2px solid #000;
  padding: 6px;
  text-align: left;
  white-space: nowrap;
  cursor: pointer;
}

thead th:hover {
  background-color: #e5f7d4;
}
.procurement-select {
  width: 100%;
  padding: 4px 6px;
  font-size: 13px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background-color: #fff;
}
select {
  width: 100%;
  padding: 4px 6px;
  font-size: 13px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background-color: #fff;
}
.status-select {
  width: 100%;
  height: 24px;
  font-size: 13px;
  border: none;
  background: transparent;
  outline: none;
  cursor: pointer;
}

.status-select:focus {
  background-color: #fff;
  border: 1px solid #4a90e2;
}
.details-row {
  display: none;
  background-color: #f9fff2;
}

.details-container {
  padding: 12px;
}

.inner-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}

.inner-table th {
  background-color: #e5f7d4;
  border: 1px solid #bfbfbf;
  padding: 6px;
  text-align: left;
}

.inner-table td {
  border: 1px solid #d9d9d9;
  padding: 6px;
}
.procurement-select {
  width: 100%;
  height: 26px;
  font-size: 12.5px;
  padding: 2px 6px;
  border: 1px solid #bfbfbf;
  border-radius: 3px;
  background-color: #ffffff;
  cursor: pointer;
}

.procurement-select:focus {
  outline: none;
  border-color: #5aa300;
  box-shadow: 0 0 2px rgba(90, 163, 0, 0.6);
}
td input {
  width: 100%;
  border: none;
  padding: 4px 6px;
  font-size: 12.5px;
  outline: none;
}

td input:focus {
  background-color: #f2fff0;
  border: 1px solid #5aa300;
}
.office-select {
  width: 100%;
  height: 26px;
  font-size: 12.5px;
  padding: 2px 6px;
  border: 1px solid #bfbfbf;
  border-radius: 3px;
  background-color: #ffffff;
  cursor: pointer;
}

.office-select:focus {
  outline: none;
  border-color: #5aa300;
  box-shadow: 0 0 2px rgba(90, 163, 0, 0.6);
}


/* ===== Paper Size Modal ===== */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
}

.modal-content {
  background: #fff;
  width: 420px;
  margin: 12% auto;
  padding: 20px;
  border-radius: 6px;
}

.modal-header {
  font-weight: bold;
  font-size: 15px;
  margin-bottom: 10px;
}

.paper-size-group label {
  display: block;
  margin: 6px 0;
  font-size: 14px;
}

.modal-buttons {
  margin-top: 15px;
  text-align: right;
}

.modal-buttons button {
  padding: 6px 12px;
  margin-left: 6px;
  cursor: pointer;
}

.btn-cancel {
  background: #ccc;
  border: none;
}

.btn-confirm {
  background: #5aa300;
  color: #fff;
  border: none;
}


  </style>

  <!-- Export Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<script>
  const headers = document.querySelectorAll("thead th");
  let sortDirection = {};

  headers.forEach(header => {
    header.addEventListener("click", () => {
      const table = header.closest("table");
      const tbody = table.querySelector("tbody");
      const rows = Array.from(tbody.querySelectorAll("tr"))
        .filter(row => row.children.length > 1); 

      const columnIndex = header.dataset.column;
      const direction = sortDirection[columnIndex] === "asc" ? "desc" : "asc";
      sortDirection[columnIndex] = direction;

      rows.sort((a, b) => {
        let aText = a.children[columnIndex].innerText.trim();
        let bText = b.children[columnIndex].innerText.trim();

        let aNum = parseFloat(aText.replace(/,/g, ""));
        let bNum = parseFloat(bText.replace(/,/g, ""));

        if (!isNaN(aNum) && !isNaN(bNum)) {
          return direction === "asc" ? aNum - bNum : bNum - aNum;
        }

        return direction === "asc"
          ? aText.localeCompare(bText)
          : bText.localeCompare(aText);
      });

      rows.forEach(row => tbody.appendChild(row));
    });
  });
</script>
<script>
function updateEndUser(officeSelect) {
  const row = officeSelect.closest("tr");
  const endUserSelect = row.querySelector(".enduser-select");

  // Clear previous options
  endUserSelect.innerHTML = '<option value="">-- Select End User --</option>';

  if (officeSelect.value === "OVP") {
    const ovpUsers = ["OVP", "ITMU", "Legal", "HCDMD", "PAU", "MSD", "HRMU", "PSMU", "FMS", "CASHIERING", "SBAC"];

    ovpUsers.forEach(user => {
      const opt = document.createElement("option");
      opt.value = user;
      opt.textContent = user;
      endUserSelect.appendChild(opt);
    });
  }
  if (officeSelect.value === "North") {
    const ovpUsers = ["Branch", "LHIO Caloocan", "Mandaluyong", "Manila", "DMW OFp", "Valenzuela"];

    ovpUsers.forEach(user => {
      const opt = document.createElement("option");
      opt.value = user;
      opt.textContent = user;
      endUserSelect.appendChild(opt);
    });
  }
  if (officeSelect.value === "Central") {
    const ovpUsers = ["Branch", "LHIO Quezon City", "LHIO Fairview", "LHIO Rizal", ];

    ovpUsers.forEach(user => {
      const opt = document.createElement("option");
      opt.value = user;
      opt.textContent = user;
      endUserSelect.appendChild(opt);
    });
  }
  if (officeSelect.value === "South") {
    const ovpUsers = ["Branch", "LHIO Makati", "LHIO Pasig", "LHIO Las pinas", "DMW LHIO paranaque", "Global Satellite Office"];

    ovpUsers.forEach(user => {
      const opt = document.createElement("option");
      opt.value = user;
      opt.textContent = user;
      endUserSelect.appendChild(opt);
    });
  }
}
</script>

<!-- Paper Size Selection Modal -->
<div id="paperSizeModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">Select Paper Size for PDF</div>

    <div class="paper-size-group">
      <label><input type="radio" name="paperSize" value="a4" checked> A4 (210 × 297 mm)</label>
      <label><input type="radio" name="paperSize" value="letter"> Letter (8.5 × 11 in)</label>
      <label><input type="radio" name="paperSize" value="legal"> Legal (8.5 × 14 in)</label>
      <label><input type="radio" name="paperSize" value="a3"> A3 (297 × 420 mm)</label>
      <label><input type="radio" name="paperSize" value="a5"> A5 (148 × 210 mm)</label>
      <label><input type="radio" name="paperSize" value="tabloid"> Tabloid (11 × 17 in)</label>
    </div>

    <div class="modal-buttons">
      <button class="btn-cancel" onclick="closePaperSizeDialog()">Cancel</button>
      <button class="btn-confirm" onclick="confirmPaperSizeAndExport()">Export PDF</button>
    </div>
  </div>
</div>



<body>
 


  <div class="header">
    <div class="logo">
      <img src="https://www.parfait.com.ph/images/product-icon/philhealth-icon.png" alt="PhilHealth Logo">
      <span>PhilHealth<br><small>Your Partner in Health</small></span>
    </div>

   <nav class="nav">
  <a href="purchase_request.html" class="active">PURCHASE REQUEST</a>
  <a href="request_for_qoutation.html">REQUEST FOR QUOTATION</a>
  <a href="philgeps_posting.html">PHILGEPS POSTING OF RFQ</a>
  <a href="notice_of_award.html">NOTICE OF AWARD</a>
  <a href="contract.html">CONTRACT</a>
  <a href="supplier_directory.html">SUPPLIER DIRECTORY</a>
</nav>

  </div>

  <main class="content">
  <div class="container">
    <table>
     <thead>
  <tr>
    <th data-column="0">Control #</th>
    <th data-column="1">Ref PR#</th>
    <th data-column="2">Supplier ID</th>
    <th data-column="3">Supplier</th>
    <th data-column="4">Contract Cost</th>
    <th data-column="5">Date Approved</th>
    <th data-column="6">Date Issued</th>
    <th data-column="7">Date Conformed</th>
  </tr>
</thead>

<tbody>
  <tr class="main-row">
    <td><input type="number" placeholder="Control #" /></td>
    <td><input type="text" placeholder="Ref PR#" /></td>
    <td><input type="number" placeholder="Supplier ID" /></td>
    <td><input type="text" placeholder="Supplier" /></td>
    <td><input type="text" placeholder="Contract Cost" /></td>
    <td><input type="date" placeholder="Date Approved" /></td>
    <td><input type="date" placeholder="Date Issued" /></td>
    <td><input type="date" placeholder="Date Conformed" /></td>

  </tr>
</tbody>

    </table>
 

    <div class="export-buttons">
      <button class="btn btn-success" onclick="exportToExcel()">
          <i class="fas fa-file-excel"></i> Save to Excel (.xlsx)
      </button>
      <button class="btn btn-danger" onclick="exportToPDF()">
          <i class="fas fa-file-pdf"></i> Save to PDF
      </button>
      <button class="btn btn-info" onclick="exportToCSV()">
          <i class="fas fa-file-csv"></i> Save to CSV
      </button>
      <button id="addRowBtn"
  style="margin:9px 0; padding:5px 10px; font-size:10px; cursor:pointer;">
  +
</button>

   </div>
</main>   

  <script>
    // Export to Excel (.xlsx)
    function exportToExcel() {
        try {
            if (typeof XLSX === 'undefined') {
                alert('XLSX library is loading. Please wait a moment and try again.');
                return;
            }
            
            const table = document.querySelector('table');
            if (!table) {
                alert('Table not found!');
                return;
            }
            
            const ws = XLSX.utils.table_to_sheet(table);
            
            // Auto-fit columns
            const colWidths = [];
            table.querySelectorAll('tr').forEach(row => {
                const cells = row.querySelectorAll('th, td');
                cells.forEach((cell, idx) => {
                    const width = Math.max((cell.textContent.length || 10) + 2, 10);
                    colWidths[idx] = Math.max(colWidths[idx] || 0, width);
                });
            });
            ws['!cols'] = colWidths.map(w => ({ wch: w }));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            const date = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `purchase_request_${date}.xlsx`);
            alert('Excel file downloaded successfully!');
        } catch (e) {
            alert('Error exporting to Excel: ' + e.message);
            console.error(e);
        }
    }

    // Export to PDF
    function exportToPDF() {
  document.getElementById("paperSizeModal").style.display = "block";
}

function closePaperSizeDialog() {
  document.getElementById("paperSizeModal").style.display = "none";
}

function confirmPaperSizeAndExport() {
  const selectedSize = document.querySelector(
    'input[name="paperSize"]:checked'
  ).value;

  closePaperSizeDialog();

  const element = document.querySelector("table");

  const opt = {
    margin: 10,
    filename: `purchase_request_${new Date().toISOString().split('T')[0]}.pdf`,
    image: { type: "jpeg", quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: {
      orientation: "landscape",
      unit: "mm",
      format: selectedSize
    }
  };

  html2pdf().set(opt).from(element).save();
}

    // Export to CSV
    function exportToCSV() {
        try {
            if (typeof XLSX === 'undefined') {
                alert('XLSX library is loading. Please wait a moment and try again.');
                return;
            }
            
            const table = document.querySelector('table');
            if (!table) {
                alert('Table not found!');
                return;
            }
            
            const ws = XLSX.utils.table_to_sheet(table);

             // Add Row button logic (only once)
    document.getElementById("addRowBtn").addEventListener("click", () => {
      const tbody = document.querySelector("table tbody");
      const lastRow = tbody.querySelector(".main-row:last-of-type");
      if (!lastRow) return;

      const newRow = lastRow.cloneNode(true);
      newRow.querySelectorAll("input").forEach(i => i.value = "");
      newRow.querySelectorAll("select").forEach(s => s.selectedIndex = 0);
      tbody.appendChild(newRow);
    });
            
            // Auto-fit columns
            const colWidths = [];
            table.querySelectorAll('tr').forEach(row => {
                const cells = row.querySelectorAll('th, td');
                cells.forEach((cell, idx) => {
                    const width = Math.max((cell.textContent.length || 10) + 2, 10);
                    colWidths[idx] = Math.max(colWidths[idx] || 0, width);
                });
            });
            ws['!cols'] = colWidths.map(w => ({ wch: w }));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            const date = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `purchase_request_${date}.csv`);
            alert('CSV file downloaded successfully!');
        } catch (e) {
            alert('Error exporting to CSV: ' + e.message);
            console.error(e);
        }
    }
  </script>
  <script>
  const currentPage = location.pathname.split("/").pop();
  document.querySelectorAll(".nav a").forEach(link => {
    if (link.getAttribute("href") === currentPage) {
      link.classList.add("active");
    } else {
      link.classList.remove("active");
    }
  });
</script>

</body>

<script>
  // Add row functionality for the "+" button (works globally)
  document.getElementById("addRowBtn").addEventListener("click", () => {
    const tbody = document.querySelector("table tbody");
    const lastRow = tbody.querySelector(".main-row:last-of-type");
    if (!lastRow) return;

    // Clone the last row
    const newRow = lastRow.cloneNode(true);

    // Clear all input values
    newRow.querySelectorAll("input").forEach(input => input.value = "");

    // Reset all selects
    newRow.querySelectorAll("select").forEach(select => select.selectedIndex = 0);

    // Reattach dynamic function for office -> enduser dropdown
    const officeSelect = newRow.querySelector(".office-select");
    if (officeSelect) {
      officeSelect.addEventListener("change", () => updateEndUser(officeSelect));
    }

    // Append the new row
    tbody.appendChild(newRow);
  });

  // Attach updateEndUser to existing rows on page load
  document.querySelectorAll(".office-select").forEach(select => {
    select.addEventListener("change", () => updateEndUser(select));
  });
</script>
<script>
  const addRowBtn = document.getElementById("addRowBtn");
  const table = document.querySelector("table tbody");

  let clipboard = null; // for Ctrl+C/Ctrl+V
  let undoStack = [];   // for undo

  // Save table state for undo
  function saveState() {
    const rowsData = Array.from(table.rows).map(r => {
      return {
        inputs: Array.from(r.querySelectorAll("input")).map(i => i.value),
        selects: Array.from(r.querySelectorAll("select")).map(s => s.selectedIndex)
      };
    });
    undoStack.push(rowsData);
    if (undoStack.length > 20) undoStack.shift();
  }

  // Restore table state
  function restoreState(state) {
    table.innerHTML = "";
    state.forEach(rowData => {
      const newRow = table.querySelector(".main-row").cloneNode(true);
      newRow.querySelectorAll("input").forEach((i, idx) => i.value = rowData.inputs[idx]);
      newRow.querySelectorAll("select").forEach((s, idx) => s.selectedIndex = rowData.selects[idx]);
      table.appendChild(newRow);
    });
  }

  // Arrow key navigation
  function moveFocus(current, direction) {
    const cells = Array.from(current.closest("tr").querySelectorAll("input, select"));
    let index = cells.indexOf(current);
    const row = current.closest("tr");
    let newCell;

    switch(direction) {
      case "ArrowRight":
        if (index < cells.length - 1) newCell = cells[index + 1];
        break;
      case "ArrowLeft":
        if (index > 0) newCell = cells[index - 1];
        break;
      case "ArrowDown":
        const nextRow = row.nextElementSibling;
        if (nextRow) newCell = nextRow.querySelectorAll("input, select")[index];
        break;
      case "ArrowUp":
        const prevRow = row.previousElementSibling;
        if (prevRow) newCell = prevRow.querySelectorAll("input, select")[index];
        break;
    }

    if (newCell) {
      newCell.focus();
      if (newCell.tagName === "INPUT") newCell.select();
    }
  }

  document.addEventListener("keydown", function(e) {
    const active = document.activeElement;
    const isInput = active.tagName === "INPUT" || active.tagName === "SELECT";

    if (e.ctrlKey) {
      switch (e.key.toLowerCase()) {
        case "f": // Ctrl+F -> add row
          e.preventDefault();
          saveState();
          addRowBtn.click();
          break;
        case "c": // Ctrl+C -> copy row
          e.preventDefault();
          if (isInput) {
            const row = active.closest("tr");
            if (row) {
              clipboard = {
                inputs: Array.from(row.querySelectorAll("input")).map(i => i.value),
                selects: Array.from(row.querySelectorAll("select")).map(s => s.selectedIndex)
              };
              alert("Row copied!");
            }
          }
          break;
        case "v": // Ctrl+V -> paste row
          e.preventDefault();
          if (clipboard) {
            saveState();
            const newRow = table.querySelector(".main-row").cloneNode(true);
            newRow.querySelectorAll("input").forEach((i, idx) => i.value = clipboard.inputs[idx]);
            newRow.querySelectorAll("select").forEach((s, idx) => s.selectedIndex = clipboard.selects[idx]);
            table.appendChild(newRow);
          }
          break;
        case "z": // Ctrl+Z -> undo
          e.preventDefault();
          if (undoStack.length > 0) {
            const lastState = undoStack.pop();
            restoreState(lastState);
          }
          break;
      }
    } else if (isInput) {
      // Arrow keys navigation
      const arrows = ["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"];
      if (arrows.includes(e.key)) {
        e.preventDefault();
        moveFocus(active, e.key);
      }
    }
  });
</script>

</html>
